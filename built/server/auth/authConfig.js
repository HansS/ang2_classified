/// <reference path='../../../typings/tsd.d.ts' />
var passport = require('passport');
var passport_local = require('passport-local');
var userService = require('../services/userService');
var passportConf = function () {
    passport.use(new passport_local.Strategy({ usernameField: 'username' }, function (username, password, next) {
        userService.findUser(username, function (err, user) {
            if (err) {
                return next(err);
            }
            if (!user || user.password !== password) {
                return next(null, null);
            }
            next(null, user);
        });
        passport.serializeUser(function (user, next) {
            next(null, user.username);
        });
        passport.deserializeUser(function (username, next) {
            userService.findUser(username, function (err, user) {
                next(err, user);
            });
        });
    }));
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = passportConf;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgvYXV0aENvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxrREFBa0Q7QUFFbEQsSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ25DLElBQUksY0FBYyxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQy9DLElBQU8sV0FBVyxXQUFXLHlCQUF5QixDQUFDLENBQUM7QUFFeEQsSUFBSSxZQUFZLEdBQUc7SUFDbEIsUUFBUSxDQUFDLEdBQUcsQ0FBQyxJQUFJLGNBQWMsQ0FBQyxRQUFRLENBQUMsRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLEVBQUUsVUFBUyxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUk7UUFFeEcsV0FBVyxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsVUFBUyxHQUFHLEVBQUUsSUFBSTtZQUNoRCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNULE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbEIsQ0FBQztZQUNELEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDekMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDekIsQ0FBQztZQUNELElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDbEIsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsYUFBYSxDQUFDLFVBQVMsSUFBSSxFQUFFLElBQUk7WUFDekMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0IsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsZUFBZSxDQUFDLFVBQVMsUUFBUSxFQUFFLElBQUk7WUFDL0MsV0FBVyxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsVUFBUyxHQUFHLEVBQUUsSUFBSTtnQkFDaEQsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNqQixDQUFDLENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQztBQUVGO2tCQUFlLFlBQVksQ0FBQyIsImZpbGUiOiJhdXRoL2F1dGhDb25maWcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPScuLi8uLi8uLi90eXBpbmdzL3RzZC5kLnRzJyAvPlxuXG52YXIgcGFzc3BvcnQgPSByZXF1aXJlKCdwYXNzcG9ydCcpO1xudmFyIHBhc3Nwb3J0X2xvY2FsID0gcmVxdWlyZSgncGFzc3BvcnQtbG9jYWwnKTtcbmltcG9ydCB1c2VyU2VydmljZSA9IHJlcXVpcmUoJy4uL3NlcnZpY2VzL3VzZXJTZXJ2aWNlJyk7XG5cbmxldCBwYXNzcG9ydENvbmYgPSBmdW5jdGlvbigpIHtcblx0cGFzc3BvcnQudXNlKG5ldyBwYXNzcG9ydF9sb2NhbC5TdHJhdGVneSh7IHVzZXJuYW1lRmllbGQ6ICd1c2VybmFtZScgfSwgZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkLCBuZXh0KSB7XG5cblx0XHR1c2VyU2VydmljZS5maW5kVXNlcih1c2VybmFtZSwgZnVuY3Rpb24oZXJyLCB1c2VyKSB7XG5cdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdHJldHVybiBuZXh0KGVycik7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIXVzZXIgfHwgdXNlci5wYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcblx0XHRcdFx0cmV0dXJuIG5leHQobnVsbCwgbnVsbCk7XG5cdFx0XHR9XG5cdFx0XHRuZXh0KG51bGwsIHVzZXIpO1xuXHRcdH0pO1xuXG5cdFx0cGFzc3BvcnQuc2VyaWFsaXplVXNlcihmdW5jdGlvbih1c2VyLCBuZXh0KSB7XG5cdFx0XHRuZXh0KG51bGwsIHVzZXIudXNlcm5hbWUpO1xuXHRcdH0pO1xuXG5cdFx0cGFzc3BvcnQuZGVzZXJpYWxpemVVc2VyKGZ1bmN0aW9uKHVzZXJuYW1lLCBuZXh0KSB7XG5cdFx0XHR1c2VyU2VydmljZS5maW5kVXNlcih1c2VybmFtZSwgZnVuY3Rpb24oZXJyLCB1c2VyKSB7XG5cdFx0XHRcdG5leHQoZXJyLCB1c2VyKTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9KSk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBwYXNzcG9ydENvbmY7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
