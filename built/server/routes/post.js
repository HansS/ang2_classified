/// <reference path='../../typings/tsd.d.ts' />
var express = require('express');
var path = require('path');
var methodOverride = require('method-override');
var multer = require('multer');
var router = express.Router();
var Post_1 = require('../models/post/Post');
var storage = multer.diskStorage({
    destination: './built/client/uploads/',
    filename: function (req, file, cb) {
        cb(null, (Math.random().toString(36) + '00000000000000000').slice(2, 10) + Date.now() + path.extname(file.originalname));
    }
});
var upload = multer({ storage: storage });
router.use(methodOverride(function (req, res) {
    if (req.body && typeof req.body === 'object' && '_method' in req.body) {
        // look in urlencoded POST bodies and delete it
        var method = req.body._method;
        delete req.body._method;
        return method;
    }
}));
router.use(function (req, res, next) {
    res.header("Access-Control-Allow-Origin", "*");
    res.header("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");
    next();
})
    .get('/', function (req, res) {
    //Post.find({ status: true }, (err, docs) => {
    Post_1.Post.find({}, function (err, docs) {
        res.status(200).json(docs);
    });
})
    .post('/upload', upload.array('uploads', 12), function (req, res, next) {
    res.status(200).json(req.files);
})
    .post('/create', function (req, res, next) {
    console.log(req.body);
    var b = req.body;
    var userId = '56ce79ee63b678a005c44b5c';
    // if (req.session["isLogin"] ) {
    // 	userId = req.session["user"]._id.toString();	
    // } 
    var post = new Post_1.Post({
        user_id: userId,
        title: b.title,
        category: b.category,
        price: b.price,
        description: b.description,
        images: b.images,
        name: b.name,
        phone: b.phone,
        state: b.state,
        city: b.city
    });
    console.log(post);
    post.save(function (err) {
        if (err) {
            res.json({ success: false, error: err });
            return;
        }
        res.json({ success: true, message: 'Successfully Post an Advertsment.' });
    });
})
    .get('/my', function (req, res) {
    Post_1.Post.find({}, function (err, docs) {
        var posts = [];
        var user = req.session["user"];
        if (req.session["isLogin"] && !user.admin) {
            for (var i = 0; i < docs.length; i++) {
                if (req.session["user"]._id == docs[i].user_id) {
                    posts.push(docs[i]);
                }
            }
        }
        else {
            for (var i = 0; i < docs.length; i++) {
                if (docs[i].status == true) {
                    posts.push(docs[i]);
                }
            }
        }
        res.json({ success: true, data: posts });
    });
})
    .get('/:id', function (req, res) {
    Post_1.Post.findOne({ _id: req.params.id }, function (err, docs) {
        (function (err) { return res.status(301).json(err); });
        res.status(200).json(docs);
    });
})
    .get('/:post_id/edit', function (req, res) {
    Post_1.Post.findOne({ _id: req.params.post_id }, function (err, docs) {
        if (err) {
            res.json({ success: false, error: err });
            return;
        }
        res.json({ success: true, data: docs });
    });
})
    .put('/:post_id', function (req, res) {
    var b = req.body;
    Post_1.Post.update({
        _id: req.params.post_id
    }, {
        title: b.title,
        category: b.category,
        price: b.price,
        description: b.description,
        name: b.name,
        phone: b.phone,
        state: b.state,
        city: b.city,
    }, function (err, post) {
        res.status(200).json({ message: 'Successfully Update Post', data: post });
    });
})
    .delete('/:post_id', function (req, res) {
    Post_1.Post.remove({ _id: req.params.post_id }, function () {
        res.status(200).json({ message: 'Successfully deleted' });
    });
});
module.exports = router;

//# sourceMappingURL=data:application/json;base64,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QUFDLENBQUMsS0FBSztRQUNkLFFBQVEsRUFBRSxDQUFDLENBQUMsUUFBUTtRQUNwQixLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUs7UUFDZCxXQUFXLEVBQUUsQ0FBQyxDQUFDLFdBQVc7UUFDMUIsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJO1FBQ1osS0FBSyxFQUFFLENBQUMsQ0FBQyxLQUFLO1FBQ2QsS0FBSyxFQUFFLENBQUMsQ0FBQyxLQUFLO1FBQ2QsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJO0tBQ1osRUFDRCxVQUFDLEdBQUcsRUFBRSxJQUFJO1FBQ1QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7SUFDMUUsQ0FBQyxDQUFDLENBQUM7QUFFSixDQUFDLENBQUM7S0FDRCxNQUFNLENBQUMsV0FBVyxFQUFFLFVBQUMsR0FBRyxFQUFFLEdBQUc7SUFFN0IsV0FBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFO1FBQ3hDLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLENBQUMsQ0FBQztJQUMzRCxDQUFDLENBQUMsQ0FBQztBQUVKLENBQUMsQ0FBQyxDQUFDO0FBRUgsaUJBQVUsTUFBTSxDQUFDIiwiZmlsZSI6InJvdXRlcy9wb3N0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD0nLi4vLi4vdHlwaW5ncy90c2QuZC50cycgLz5cblxuaW1wb3J0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbnZhciBtZXRob2RPdmVycmlkZSA9IHJlcXVpcmUoJ21ldGhvZC1vdmVycmlkZScpO1xudmFyIG11bHRlciA9IHJlcXVpcmUoJ211bHRlcicpO1xudmFyIHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cbmltcG9ydCB7SVVzZXJNb2RlbCwgVXNlcn0gZnJvbSAnLi4vbW9kZWxzL3VzZXIvVXNlcic7XG5pbXBvcnQge0lQb3N0TW9kZWwsIFBvc3R9IGZyb20gJy4uL21vZGVscy9wb3N0L1Bvc3QnO1xuXG52YXIgc3RvcmFnZSA9IG11bHRlci5kaXNrU3RvcmFnZSh7XG5cdGRlc3RpbmF0aW9uOiAnLi9idWlsdC9jbGllbnQvdXBsb2Fkcy8nLFxuXHRmaWxlbmFtZTogZnVuY3Rpb24ocmVxLCBmaWxlLCBjYikge1xuICAgICAgICBjYihudWxsLCAoTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikgKyAnMDAwMDAwMDAwMDAwMDAwMDAnKS5zbGljZSgyLCAxMCkgKyBEYXRlLm5vdygpICsgcGF0aC5leHRuYW1lKGZpbGUub3JpZ2luYWxuYW1lKSk7XG5cdH1cbn0pO1xudmFyIHVwbG9hZCA9IG11bHRlcih7IHN0b3JhZ2U6IHN0b3JhZ2UgfSk7XG5yb3V0ZXIudXNlKG1ldGhvZE92ZXJyaWRlKGZ1bmN0aW9uKHJlcSwgcmVzKSB7XG5cdGlmIChyZXEuYm9keSAmJiB0eXBlb2YgcmVxLmJvZHkgPT09ICdvYmplY3QnICYmICdfbWV0aG9kJyBpbiByZXEuYm9keSkge1xuXHRcdC8vIGxvb2sgaW4gdXJsZW5jb2RlZCBQT1NUIGJvZGllcyBhbmQgZGVsZXRlIGl0XG5cdFx0dmFyIG1ldGhvZCA9IHJlcS5ib2R5Ll9tZXRob2Rcblx0XHRkZWxldGUgcmVxLmJvZHkuX21ldGhvZFxuXHRcdHJldHVybiBtZXRob2Rcblx0fVxufSkpXG5cbnJvdXRlci51c2UoZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHtcbiAgICByZXMuaGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luXCIsIFwiKlwiKTtcbiAgICByZXMuaGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVyc1wiLCBcIk9yaWdpbiwgWC1SZXF1ZXN0ZWQtV2l0aCwgQ29udGVudC1UeXBlLCBBY2NlcHRcIik7XG4gICAgbmV4dCgpO1xufSlcbi5nZXQoJy8nLCAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSkgPT4ge1xuXHQvL1Bvc3QuZmluZCh7IHN0YXR1czogdHJ1ZSB9LCAoZXJyLCBkb2NzKSA9PiB7XG5cdFBvc3QuZmluZCh7fSwgKGVyciwgZG9jcykgPT4ge1xuXHRcdHJlcy5zdGF0dXMoMjAwKS5qc29uKGRvY3MpO1x0XHRcdFx0XHRcblx0fSk7XG59KVxuLnBvc3QoJy91cGxvYWQnLCB1cGxvYWQuYXJyYXkoJ3VwbG9hZHMnLCAxMiksIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0KSA9PiB7XHRcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbihyZXEuZmlsZXMpO1x0XG59KVxuLy8ucG9zdCgnL2NyZWF0ZScsIHVwbG9hZC5hcnJheSgnaW1hZ2VzJywgMTIpLCAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSwgbmV4dCkgPT4ge1x0XG4ucG9zdCgnL2NyZWF0ZScsICAocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSwgbmV4dCkgPT4ge1xuXHRjb25zb2xlLmxvZyhyZXEuYm9keSk7XG5cdGxldCBiID0gcmVxLmJvZHk7XG5cdHZhciB1c2VySWQgPSAnNTZjZTc5ZWU2M2I2NzhhMDA1YzQ0YjVjJztcblx0XG5cdC8vIGlmIChyZXEuc2Vzc2lvbltcImlzTG9naW5cIl0gKSB7XG5cdC8vIFx0dXNlcklkID0gcmVxLnNlc3Npb25bXCJ1c2VyXCJdLl9pZC50b1N0cmluZygpO1x0XG5cdC8vIH0gXG5cdGxldCBwb3N0OiBJUG9zdE1vZGVsID0gbmV3IFBvc3Qoe1xuXHRcdHVzZXJfaWQ6IHVzZXJJZCxcblx0XHR0aXRsZTogYi50aXRsZSxcblx0XHRjYXRlZ29yeTogYi5jYXRlZ29yeSxcblx0XHRwcmljZTogYi5wcmljZSxcblx0XHRkZXNjcmlwdGlvbjogYi5kZXNjcmlwdGlvbixcblx0XHRpbWFnZXM6IGIuaW1hZ2VzLFxuXHRcdG5hbWU6IGIubmFtZSxcblx0XHRwaG9uZTogYi5waG9uZSxcblx0XHRzdGF0ZTogYi5zdGF0ZSxcblx0XHRjaXR5OiBiLmNpdHlcblx0fSk7XG5cdGNvbnNvbGUubG9nKHBvc3QpO1xuXHRwb3N0LnNhdmUoZnVuY3Rpb24oZXJyKSB7XG5cdFx0aWYgKGVycikge1x0XHRcdFxuXHRcdFx0cmVzLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVyciB9KTtcblx0XHRcdHJldHVybjtcdFxuXHRcdH1cblx0XHRyZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdTdWNjZXNzZnVsbHkgUG9zdCBhbiBBZHZlcnRzbWVudC4nIH0pO1xuXHR9KTtcblxufSlcbi5nZXQoJy9teScsIChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKSA9PiB7XG5cblx0UG9zdC5maW5kKHt9LCAoZXJyLCBkb2NzKSA9PiB7XG5cblx0XHR2YXIgcG9zdHMgPSBbXTtcblx0XHRcdFxuXHRcdHZhciB1c2VyID0gcmVxLnNlc3Npb25bXCJ1c2VyXCJdO1xuXG5cdFx0aWYgKHJlcS5zZXNzaW9uW1wiaXNMb2dpblwiXSAmJiAhdXNlci5hZG1pbikge1xuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkb2NzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGlmIChyZXEuc2Vzc2lvbltcInVzZXJcIl0uX2lkID09IGRvY3NbaV0udXNlcl9pZCkge1xuXHRcdFx0XHRcdHBvc3RzLnB1c2goZG9jc1tpXSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkb2NzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGlmIChkb2NzW2ldLnN0YXR1cyA9PSB0cnVlKSB7XG5cdFx0XHRcdFx0cG9zdHMucHVzaChkb2NzW2ldKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0XHRcblx0XHRyZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHBvc3RzIH0pO1xuXHR9KTtcblxufSlcbi5nZXQoJy86aWQnICwgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcblxuXHRQb3N0LmZpbmRPbmUoeyBfaWQ6IHJlcS5wYXJhbXMuaWQgfSwgKGVyciwgZG9jcykgPT4ge1xuXG5cdFx0KGVycikgPT4gcmVzLnN0YXR1cygzMDEpLmpzb24oZXJyKTtcblx0XHRyZXMuc3RhdHVzKDIwMCkuanNvbihkb2NzKTtcdFxuXHRcdFxuXHR9KTtcblxufSlcbi5nZXQoJy86cG9zdF9pZC9lZGl0JywgKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpID0+IHtcblxuXHRQb3N0LmZpbmRPbmUoeyBfaWQ6IHJlcS5wYXJhbXMucG9zdF9pZCB9LCAoZXJyLCBkb2NzKSA9PiB7XG5cblx0XHRpZihlcnIpIHtcblx0XHRcdHJlcy5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnIgfSk7XHRcblx0XHRcdHJldHVybjtcdFx0XG5cdFx0fVxuXHRcdHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogZG9jcyB9KTtcblx0fSk7XG5cbn0pXG4ucHV0KCcvOnBvc3RfaWQnLCAocmVxLCByZXMpID0+IHtcblxuXHR2YXIgYiA9IHJlcS5ib2R5O1xuXG5cdFBvc3QudXBkYXRlKFxuXHR7XG5cdFx0X2lkOiByZXEucGFyYW1zLnBvc3RfaWRcblx0fSxcblx0e1xuXHRcdHRpdGxlOiBiLnRpdGxlLFxuXHRcdGNhdGVnb3J5OiBiLmNhdGVnb3J5LFxuXHRcdHByaWNlOiBiLnByaWNlLFxuXHRcdGRlc2NyaXB0aW9uOiBiLmRlc2NyaXB0aW9uLFxuXHRcdG5hbWU6IGIubmFtZSxcblx0XHRwaG9uZTogYi5waG9uZSxcblx0XHRzdGF0ZTogYi5zdGF0ZSxcblx0XHRjaXR5OiBiLmNpdHksXG5cdH0sXG5cdChlcnIsIHBvc3QpID0+IHtcblx0XHRyZXMuc3RhdHVzKDIwMCkuanNvbih7bWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSBVcGRhdGUgUG9zdCcsIGRhdGE6IHBvc3QgfSk7XHRcdFxuXHR9KTtcblxufSlcbi5kZWxldGUoJy86cG9zdF9pZCcsIChyZXEsIHJlcykgPT4ge1xuXG5cdFBvc3QucmVtb3ZlKHsgX2lkOiByZXEucGFyYW1zLnBvc3RfaWQgfSwgKCkgPT4ge1xuXHRcdHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSBkZWxldGVkJyB9KTtcblx0fSk7XG5cbn0pO1xuXG5leHBvcnQgID0gcm91dGVyO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
